<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kalyan — GreatFrontEnd Daily Planner</title>
  <style>
    :root{
      --bg: #0b0f14;           /* deep slate */
      --card: #111722;         /* night blue */
      --muted: #9fb0c0;
      --text: #e8f0f8;
      --accent: #4cc9f0;       /* cyan */
      --accent-2: #80ffdb;     /* mint */
      --js: #ffd166;           /* honey */
      --ui: #7ae582;           /* green */
      --warn: #ffadad;         /* blush */
      --ok: #a0f0ff;
      --ring: 0 0 0 2px rgba(76,201,240,.35),0 10px 20px rgba(0,0,0,.25);
      --radius: 16px;
    }
    @media (prefers-color-scheme: light) {
      :root{
        --bg:#f6f8fb; --card:#ffffff; --text:#0b0f14; --muted:#4a5a6a;
        --ring: 0 0 0 2px rgba(76,201,240,.45),0 12px 24px rgba(0,0,0,.12);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#0b0f14 320px) fixed;color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    a{color:var(--accent)}

    .container{max-width:1200px;margin:0 auto;padding:20px}

    header{
      position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(11,15,20,.95),rgba(11,15,20,.6));
      backdrop-filter: blur(6px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .toolbar{display:grid;grid-template-columns:1fr auto auto auto;gap:12px;align-items:center;padding:16px 20px}
    .title{font-size:22px;font-weight:700;letter-spacing:.2px}
    .toolbar .actions{display:flex;gap:10px;flex-wrap:wrap}

    .meta{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:18px 0}
    .stat{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:14px 16px;box-shadow:var(--ring)}
    .stat h4{margin:0 0 6px 0;font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.12em}
    .stat .big{font-size:22px;font-weight:800}
    .bar{height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;margin-top:8px}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0}

    .controls{display:flex;gap:10px;flex-wrap:wrap}
    .controls input,.controls select,.controls button{
      background:var(--card);color:var(--text);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px 12px;outline:none
    }
    .controls button{cursor:pointer;transition:.2s transform ease}
    .controls button:hover{transform:translateY(-1px)}

    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:12px}
    @media (max-width: 980px){.grid{grid-template-columns:repeat(4,1fr)}}
    @media (max-width: 720px){.grid{grid-template-columns:repeat(2,1fr)}}

    .day{background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:var(--radius);padding:12px;display:flex;flex-direction:column;gap:10px;min-height:170px}
    .day.today{outline:2px dashed var(--accent);outline-offset:2px}
    .day .head{display:flex;justify-content:space-between;align-items:center}
    .day .head .date{font-weight:700}
    .badge{font-size:12px;border-radius:999px;padding:2px 8px;border:1px solid rgba(255,255,255,.14);color:var(--muted)}
    .counts{display:flex;gap:8px;flex-wrap:wrap}
    .chip{font-size:12px;border-radius:999px;padding:4px 8px;border:1px solid rgba(255,255,255,.14)}
    .chip.js{background:rgba(255,209,102,.12);border-color:rgba(255,209,102,.3)}
    .chip.ui{background:rgba(122,229,130,.12);border-color:rgba(122,229,130,.3)}
    .blocks{display:flex;flex-direction:column;gap:6px}
    .block{font-size:13px;background:rgba(255,255,255,.04);border:1px dashed rgba(255,255,255,.1);border-radius:10px;padding:8px 10px}
    .block small{opacity:.75}

    .progress{display:flex;gap:10px}
    .progress input{width:52px;text-align:center}

    .foot{margin-top:auto;display:flex;justify-content:space-between;align-items:center;gap:8px}

    .legend{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 20px}
    .legend .chip{opacity:.9}

    .empty{opacity:.75;font-style:italic}
    .soft{opacity:.8}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="toolbar">
        <div class="title">GreatFrontEnd Daily Planner — Kalyan</div>
        <div class="actions">
          <button id="btnExportCSV" title="Export progress CSV">Export CSV</button>
          <button id="btnExportICS" title="Export full calendar (.ics)">Export ICS</button>
          <button id="btnReset" title="Clear saved progress">Reset Progress</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="meta" id="stats">
      <div class="stat"><h4>JS planned</h4><div class="big" id="jsPlanned">–</div><div class="bar"><span id="barJS"></span></div></div>
      <div class="stat"><h4>JS completed</h4><div class="big" id="jsDone">0</div></div>
      <div class="stat"><h4>UI planned</h4><div class="big" id="uiPlanned">–</div><div class="bar"><span id="barUI"></span></div></div>
      <div class="stat"><h4>UI completed</h4><div class="big" id="uiDone">0</div></div>
    </section>

    <section class="controls">
      <label class="soft">Week:
        <select id="weekSelect"></select>
      </label>
      <label class="soft">Show:
        <select id="filterSelect">
          <option value="all">All days</option>
          <option value="tasks">Only days with tasks</option>
        </select>
      </label>
      <label class="soft">Search date:
        <input type="date" id="jumpDate" />
      </label>
      <button id="btnToday">Jump to Today</button>
    </section>

    <div class="legend">
      <span class="chip js">JS = JavaScript function problems</span>
      <span class="chip ui">UI = GreatFrontEnd UI challenges</span>
      <span class="chip">Quick Review = short reflection block</span>
    </div>

    <section class="grid" id="grid"></section>

    <p class="soft">Tip: type numbers directly into JS/UI done boxes; your progress is saved locally.</p>
  </main>

  <script>
    // ====== CONFIG ======
    const START = localDate(2025, 8, 25);  // Mon (local date, no TZ drift)
    const END   = localDate(2025, 12, 1);  // Mon (wrap-up)

    const jsTargets = [12,12,11,11,10,10,8,10,10,10,9,9,8,10];
    const uiTargets = [ 4, 4, 4, 4, 5, 5,3, 5, 5, 5,4,5,4,2];

    const DAYS = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

    const TIMEBLOCKS = {
      Mon_JS:  ['20:45','22:30','GFE — JS'],
      Tue_UI:  ['20:45','22:15','GFE — UI'],
      Wed_JS:  ['20:15','21:45','GFE — JS'],
      Wed_REV: ['23:15','23:45','GFE — Quick Review'],
      Thu_UI:  ['19:00','21:00','GFE — UI'],
      Fri_JS:  ['18:00','20:00','GFE — JS'],
      Fri_UI:  ['18:00','20:00','GFE — UI'],
      Sat_UI:  ['10:00','13:00','GFE — UI'],
      Sat_JS:  ['15:00','17:00','GFE — JS'],
      Sun_JS:  ['11:00','13:00','GFE — JS'],
      Sun_RET: ['17:00','18:00','GFE — Weekly Retrospective'],
      Sun_UI:  ['18:00','19:00','GFE — UI'],
      Dec1:    ['20:00','22:00','GFE — Mock Interview + Final Review']
    };

    // ====== UTIL ======
    function z2(n){ return String(n).padStart(2,'0'); }
    function localDate(y,m,d){
      // Build a local date at NOON to avoid DST/UTC rollover issues
      return new Date(y, m-1, d, 12, 0, 0, 0);
    }
    function iso(d){ return `${d.getFullYear()}-${z2(d.getMonth()+1)}-${z2(d.getDate())}`; }
    function addDays(d, n){ const t = new Date(d); t.setDate(t.getDate()+n); return t; }
    function rangeByDay(start, end){ const out=[]; for(let d=new Date(start); d<=end; d=addDays(d,1)) out.push(new Date(d)); return out; }
    function daysSinceStart(date){
      const sUTC = Date.UTC(START.getFullYear(), START.getMonth(), START.getDate());
      const dUTC = Date.UTC(date.getFullYear(),  date.getMonth(),  date.getDate());
      return Math.floor((dUTC - sUTC)/86400000);
    }
    function weekIndex(date){
      const days = daysSinceStart(date);
      return Math.min(Math.floor(days/7), 14);
    }

    // ====== DISTRIBUTION (match earlier plan) ======
    function weekDistribution(jsTarget, uiTarget){
      const js = {Mon:2, Tue:0, Wed:2, Thu:0, Fri:1, Sat:2, Sun:3}; // =10
      const ui = {Mon:0, Tue:1, Wed:0, Thu:1, Fri:0, Sat:1, Sun:0}; // =3

      if(uiTarget === 4){
        ui.Fri = 1; // add Friday UI
        js.Fri = 0; // remove Friday JS
        js.Mon += 1; // compensate
      } else if(uiTarget === 5){
        ui.Fri = 1; ui.Sun = 1;
        js.Fri = 0;
        js.Mon += 1; js.Wed += 1;
        js.Sun = Math.max(0, js.Sun - 1);
      } else if(uiTarget === 2){
        ui.Sat = 0; // lighter UI week
        // Fri remains JS by default
      }

      const orderAdd = ['Wed','Mon','Sat','Sun','Fri'];
      const orderSub = ['Sun','Fri','Sat','Mon','Wed'];
      let currentJS = Object.values(js).reduce((a,b)=>a+b,0);
      let diff = jsTarget - currentJS;
      while(diff>0){ for(const d of orderAdd){ js[d]++; diff--; if(!diff) break; } }
      while(diff<0){ for(const d of orderSub){ if(js[d]>0){ js[d]--; diff++; if(!diff) break; } } }
      // sanity
      const totalJS = Object.values(js).reduce((a,b)=>a+b,0);
      const totalUI = Object.values(ui).reduce((a,b)=>a+b,0);
      if(totalJS!==jsTarget || totalUI!==uiTarget){
        throw new Error(`Week dist mismatch JS=${totalJS}/${jsTarget} UI=${totalUI}/${uiTarget}`);
      }
      return {js, ui};
    }

    function buildPlan(){
      const days = rangeByDay(START, END);
      const weeklyCache = new Map();
      const records = [];

      for(const date of days){
        const idx = weekIndex(date);
        const dayName = DAYS[date.getDay()];
        const rec = {date: iso(date), dow: dayName, jsCount:0, uiCount:0, blocks:[], notes:''};

        if(idx <= 13){
          if(!weeklyCache.has(idx)) weeklyCache.set(idx, weekDistribution(jsTargets[idx], uiTargets[idx]));
          const {js, ui} = weeklyCache.get(idx);
          rec.jsCount = js[dayName] ?? 0;
          rec.uiCount = ui[dayName] ?? 0;

          if(dayName==='Mon'){
            if(rec.jsCount>0) rec.blocks.push(block('Mon_JS', rec.jsCount));
          } else if(dayName==='Tue'){
            if(rec.uiCount>0) rec.blocks.push(block('Tue_UI', rec.uiCount));
          } else if(dayName==='Wed'){
            if(rec.jsCount>0) rec.blocks.push(block('Wed_JS', rec.jsCount));
            rec.blocks.push(block('Wed_REV'));
          } else if(dayName==='Thu'){
            if(rec.uiCount>0) rec.blocks.push(block('Thu_UI', rec.uiCount));
          } else if(dayName==='Fri'){
            if(rec.uiCount>0) rec.blocks.push(block('Fri_UI', rec.uiCount));
            else if(rec.jsCount>0) rec.blocks.push(block('Fri_JS', rec.jsCount));
          } else if(dayName==='Sat'){
            if(rec.uiCount>0) rec.blocks.push(block('Sat_UI', rec.uiCount));
            if(rec.jsCount>0) rec.blocks.push(block('Sat_JS', rec.jsCount));
          } else if(dayName==='Sun'){
            if(rec.jsCount>0) rec.blocks.push(block('Sun_JS', rec.jsCount));
            rec.blocks.push(block('Sun_RET'));
            if(rec.uiCount>0) rec.blocks.push(block('Sun_UI', rec.uiCount));
          }
        } else {
          rec.notes = 'Mock interview & final review';
          rec.blocks.push(block('Dec1'));
        }

        records.push(rec);
      }

      // assertions up to Nov 30
      const cutoff = '2025-11-30';
      const sumJS = records.filter(r=>r.date<=cutoff).reduce((a,r)=>a+r.jsCount,0);
      const sumUI = records.filter(r=>r.date<=cutoff).reduce((a,r)=>a+r.uiCount,0);
      if(sumJS!==140 || sumUI!==59){
        console.warn('Planned totals mismatch', {sumJS,sumUI});
      }
      return records;
    }

    function block(key, count){
      const [s,e,title] = TIMEBLOCKS[key];
      return {start:s, end:e, title: count?`${title} (${count})`:title};
    }

    // ====== RENDER ======
    const state = {
      records: buildPlan(),
      filterWeek: 'all',
      showOnlyTasks: false,
    };

    function initWeekSelect(){
      const sel = document.getElementById('weekSelect');
      sel.innerHTML = '<option value="all">All weeks</option>';
      const start = new Date(START);
      for(let w=0; w<14; w++){
        const ws = addDays(start, w*7);
        const we = addDays(ws, 6);
        const label = `W${w+1} — ${iso(ws)} → ${iso(we)}`;
        const opt = document.createElement('option');
        opt.value = String(w); opt.textContent = label; sel.appendChild(opt);
      }
      const optDec1 = document.createElement('option');
      optDec1.value = '14'; optDec1.textContent = 'Dec 1 — Wrap-up'; sel.appendChild(optDec1);
      sel.addEventListener('change', ()=>{ state.filterWeek = sel.value; render(); });
    }

    function initFilterSelect(){
      const sel = document.getElementById('filterSelect');
      sel.addEventListener('change', ()=>{ state.showOnlyTasks = (sel.value==='tasks'); render(); });
    }

    function initJumpers(){
      document.getElementById('btnToday').addEventListener('click', ()=>{
        const todayId = iso(new Date());
        const el = document.querySelector(`[data-date="${todayId}"]`);
        if(el) el.scrollIntoView({behavior:'smooth', block:'center'});
      });
      document.getElementById('jumpDate').addEventListener('change', (e)=>{
        const dateId = e.target.value; if(!dateId) return;
        const el = document.querySelector(`[data-date="${dateId}"]`);
        if(el) el.scrollIntoView({behavior:'smooth', block:'center'});
      });
    }

    function getProgress(date){
      try{ return JSON.parse(localStorage.getItem('gfe:'+date)) || {js:0, ui:0}; }catch{ return {js:0, ui:0}; }
    }
    function setProgress(date, js, ui){
      localStorage.setItem('gfe:'+date, JSON.stringify({js,ui}));
      updateStats();
    }

    function render(){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      const todayStr = iso(new Date());
      const recs = state.records.filter(r => {
        const wi = weekIndex(new Date(r.date));
        if(state.filterWeek!=='all' && String(wi)!==String(state.filterWeek)) return false;
        if(state.showOnlyTasks && (r.jsCount+r.uiCount)===0) return false;
        return true;
      });

      for(const r of recs){
        const card = document.createElement('article');
        card.className = 'day';
        card.dataset.date = r.date;
        if(r.date === todayStr) card.classList.add('today');

        const head = document.createElement('div');
        head.className = 'head';
        head.innerHTML = `<div class="date">${r.dow} • ${r.date}</div>`;
        const wk = weekIndex(new Date(r.date));
        const badge = document.createElement('span');
        badge.className = 'badge';
        badge.textContent = wk<=13 ? `W${wk+1}` : 'Wrap';
        head.appendChild(badge);

        const counts = document.createElement('div');
        counts.className = 'counts';
        counts.innerHTML = `<span class="chip js">JS: ${r.jsCount}</span><span class="chip ui">UI: ${r.uiCount}</span>`;

        const blocks = document.createElement('div');
        blocks.className = 'blocks';
        if(r.blocks.length){
          for(const b of r.blocks){
            const el = document.createElement('div');
            el.className = 'block';
            el.innerHTML = `<strong>${b.title}</strong><br><small>${b.start}–${b.end}</small>`;
            blocks.appendChild(el);
          }
        } else {
          const empty = document.createElement('div'); empty.className='empty'; empty.textContent='No scheduled work'; blocks.appendChild(empty);
        }

        const foot = document.createElement('div');
        foot.className = 'foot';
        const prog = document.createElement('div');
        prog.className = 'progress';
        const saved = getProgress(r.date);
        prog.innerHTML = `
          <label>JS done <input type="number" min="0" max="${r.jsCount}" step="1" value="${saved.js}"></label>
          <label>UI done <input type="number" min="0" max="${r.uiCount}" step="1" value="${saved.ui}"></label>
        `;
        const [jsInput, uiInput] = prog.querySelectorAll('input');
        jsInput.addEventListener('input', ()=>{ clamp(jsInput, 0, r.jsCount); setProgress(r.date, Number(jsInput.value||0), Number(uiInput.value||0)); });
        uiInput.addEventListener('input', ()=>{ clamp(uiInput, 0, r.uiCount); setProgress(r.date, Number(jsInput.value||0), Number(uiInput.value||0)); });

        const hint = document.createElement('span');
        hint.className = 'soft';
        hint.textContent = r.notes || '';

        foot.appendChild(prog); foot.appendChild(hint);

        card.appendChild(head);
        card.appendChild(counts);
        card.appendChild(blocks);
        card.appendChild(foot);
        grid.appendChild(card);
      }
      updateStats();
    }

    function clamp(inp, min, max){ if(inp.value==='') return; const n=Number(inp.value); if(n<min) inp.value=min; if(n>max) inp.value=max; }

    function updateStats(){
      const cutoff = '2025-11-30';
      const plannedJS = state.records.filter(r=>r.date<=cutoff).reduce((a,r)=>a+r.jsCount,0);
      const plannedUI = state.records.filter(r=>r.date<=cutoff).reduce((a,r)=>a+r.uiCount,0);
      const done = state.records.filter(r=>r.date<=cutoff).map(r=>getProgress(r.date));
      const doneJS = done.reduce((a,p)=>a+(p.js||0),0);
      const doneUI = done.reduce((a,p)=>a+(p.ui||0),0);
      document.getElementById('jsPlanned').textContent = plannedJS;
      document.getElementById('uiPlanned').textContent = plannedUI;
      document.getElementById('jsDone').textContent   = doneJS;
      document.getElementById('uiDone').textContent   = doneUI;
      const pctJS = Math.min(100, Math.round(100*doneJS/Math.max(1,plannedJS)));
      const pctUI = Math.min(100, Math.round(100*doneUI/Math.max(1,plannedUI)));
      document.getElementById('barJS').style.width = pctJS+'%';
      document.getElementById('barUI').style.width = pctUI+'%';
    }

    // ====== EXPORTS ======
    function download(filename, text){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(new Blob([text], {type:'text/plain'}));
      a.download = filename; a.click(); URL.revokeObjectURL(a.href);
    }

    function exportCSV(){
      const rows = [['Date','Day','JS_count','UI_count','JS_done','UI_done','Blocks','Notes']];
      for(const r of state.records){
        const p = getProgress(r.date);
        const blocks = r.blocks.map(b=>`${b.start}-${b.end} ${b.title}`).join(' | ');
        rows.push([r.date, r.dow, r.jsCount, r.uiCount, p.js||0, p.ui||0, blocks, r.notes||'']);
      }
      const csv = rows.map(row=>row.map(cell => String(cell).includes(',')||String(cell).includes('"')? '"'+String(cell).replace(/"/g,'""')+'"' : String(cell)).join(',')).join('\n');
      download('gfe_kalyan_daily_plan.csv', csv);
    }

    function pad(n){ return String(n).padStart(2,'0'); }
    function icsDate(dateStr, timeStr){
      // naive local to floating DTSTART (many calendars accept floating in local tz)
      const [H,M] = timeStr.split(':').map(Number);
      const d = new Date(dateStr+'T'+pad(H)+':'+pad(M)+':00');
      return d.getFullYear()+pad(d.getMonth()+1)+pad(d.getDate())+'T'+pad(H)+pad(M)+'00';
    }
    function exportICS(){
      const lines = [
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Kalyan GFE Plan//EN','CALSCALE:GREGORIAN','METHOD:PUBLISH'
      ];
      for(const r of state.records){
        for(const b of r.blocks){
          const uid = `${r.date}-${b.start.replace(':','')}-${hash(b.title)}@gfe-plan`;
          lines.push('BEGIN:VEVENT');
          lines.push('UID:'+uid);
          lines.push('DTSTAMP:'+new Date().toISOString().replace(/[-:]/g,'').replace(/\..+/,''));
          lines.push('DTSTART:'+icsDate(r.date, b.start));
          lines.push('DTEND:'+icsDate(r.date, b.end));
          lines.push('SUMMARY:'+escapeICS(b.title));
          lines.push('END:VEVENT');
        }
      }
      lines.push('END:VCALENDAR');
      download('gfe_kalyan_daily_plan.ics', lines.join('\n'));
    }
    function escapeICS(s){ return s.replace(/,/g,'\\,').replace(/;/g,'\\;'); }
    function hash(s){ let h=0; for(let i=0;i<s.length;i++){ h=(h<<5)-h+s.charCodeAt(i); h|=0; } return Math.abs(h); }

    function resetProgress(){
      if(!confirm('Reset all saved JS/UI progress?')) return;
      for(const r of state.records){ localStorage.removeItem('gfe:'+r.date); }
      render();
    }

    // ====== BOOT ======
    initWeekSelect();
    initFilterSelect();
    initJumpers();
    document.getElementById('btnExportCSV').addEventListener('click', exportCSV);
    document.getElementById('btnExportICS').addEventListener('click', exportICS);
    document.getElementById('btnReset').addEventListener('click', resetProgress);
    render();
  </script>
</body>
</html>
